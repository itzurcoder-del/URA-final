<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>URA â€” Chat with memory</title>
<style>
  :root {
    --bg:#eef5f7; --panel:#fff; --muted:#6b7280; --accent:#06b6d4; --bot:#22c55e; --user:#0ea5e9;
    --radius:14px;
  }
  *{box-sizing:border-box}
  body{font-family:Inter,system-ui,Arial;margin:0;height:100vh;background:var(--bg);color:#111;display:flex;overflow:hidden}

  /* Sidebar */
  #sidebar{
    width:280px;background:var(--panel);box-shadow:2px 0 18px rgba(12,12,12,0.06);
    padding:14px;display:flex;flex-direction:column;gap:12px;z-index:20;
  }
  #brand{font-weight:700;font-size:16px}
  #chatsList{flex:1;overflow:auto;display:flex;flex-direction:column;gap:8px}
  .chat-item{padding:10px;border-radius:12px;cursor:pointer;color:#111;background:transparent}
  .chat-item.active{background:#edf7ff}
  #newChat{padding:8px;border-radius:10px;border:1px dashed #e6eef6;background:transparent;cursor:pointer;width:100%}
  #sidebar .muted{color:var(--muted);font-size:13px}
  #controls-wrap{display:flex;gap:8px}
  #signinBtn,#signoutBtn{padding:8px 10px;border-radius:8px;border:none;background:var(--accent);color:#000;cursor:pointer}
  #signoutBtn{background:#ef4444;color:#fff}

  /* Main area */
  #main{flex:1;display:flex;flex-direction:column;position:relative}
  header{
    height:64px;display:flex;align-items:center;justify-content:space-between;
    padding:0 18px;background:transparent;z-index:10;
  }
  header h1{margin:0;font-size:18px}
  #chat{flex:1;padding:18px;overflow:auto;display:flex;flex-direction:column;gap:12px}
  .msg{max-width:72%;padding:12px 16px;border-radius:var(--radius);word-wrap:break-word;line-height:1.45;
       position:relative;box-shadow:0 6px 18px rgba(0,0,0,0.03)}
  .msg.user{align-self:flex-end;background:var(--user);color:#000;border-bottom-right-radius:6px}
  .msg.bot{align-self:flex-start;background:var(--bot);color:#fff;border-bottom-left-radius:6px}
  .msg-controls{margin-top:8px;display:flex;gap:8px}
  .msg-controls button{padding:6px 8px;border-radius:8px;border:none;background:#fff;color:#111;cursor:pointer}
  .controls{display:flex;gap:10px;padding:12px;border-top:1px solid #e6eef6;align-items:center;background:transparent}
  textarea{flex:1;height:52px;padding:12px;border-radius:999px;border:1px solid #e6eef6;outline:none;resize:none}
  button.primary{background:var(--accent);color:#000;border:none;padding:10px 14px;border-radius:12px;cursor:pointer}
  button.icon{width:44px;height:44px;border-radius:50%;background:#fff;border:1px solid #e6eef6;cursor:pointer}

  select, #themeToggle{padding:6px 10px;border-radius:8px;border:none;background:var(--panel);color:var(--muted)}

  /* Mobile styles */
  #menuBtn{
    display:none;
    background:none;border:none;font-size:24px;cursor:pointer;color:#111;
  }
  @media(max-width:900px){
    #sidebar{
      position:fixed;left:0;top:0;height:100%;transform:translateX(-100%);
      transition:transform 0.25s ease;
    }
    #sidebar.open{transform:translateX(0)}
    #menuBtn{display:inline-block}
    #chat{padding:12px}
    .msg{max-width:92%}
  }
</style>
</head>
<body>

  <!-- Sidebar -->
  <div id="sidebar">
    <div id="brand">URA â€” Chats</div>
    <div style="display:flex;align-items:center;justify-content:space-between">
      <div class="muted">Chats</div>
      <button id="newChat" class="small">+ New</button>
    </div>
    <div id="chatsList"></div>
    <div id="controls-wrap">
      <button id="signinBtn">Sign in</button>
      <button id="signoutBtn" style="display:none">Sign out</button>
    </div>
    <div class="muted" style="font-size:13px">Signed in: <span id="userEmail">not signed</span></div>
  </div>

  <!-- Main -->
  <div id="main">
    <header>
      <button id="menuBtn">â˜°</button>
      <h1>URA â€” Your assistant</h1>
      <div style="display:flex;align-items:center;gap:12px">
        <label class="muted">Voice:</label>
        <select id="voiceSelect"></select>
        <button id="themeToggle">ðŸŒ™</button>
      </div>
    </header>

    <div id="chat"></div>

    <div class="controls">
      <button id="micBtn" class="icon">ðŸŽ¤</button>
      <textarea id="input" placeholder="Type your message... (Press Enter)"></textarea>
      <button id="send" class="primary">Send</button>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAfbJJEw61oIaMKUIFMGVK062g376dSrXI",
  authDomain: "ura-ai-b1b20.firebaseapp.com",
  projectId: "ura-ai-b1b20",
  storageBucket: "ura-ai-b1b20.firebasestorage.app",
  messagingSenderId: "330104435643",
  appId: "1:330104435643:web:6f1d6f338a2e0de6cb0a9e"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const GROQ_API_KEY = "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";
const MODEL = "llama-3.3-70b-versatile";

const sidebar = document.getElementById("sidebar");
const menuBtn = document.getElementById("menuBtn");
menuBtn.onclick = () => sidebar.classList.toggle("open");

const chatEl = document.getElementById("chat");
const inputEl = document.getElementById("input");
const sendBtn = document.getElementById("send");
const micBtn = document.getElementById("micBtn");
const chatsListEl = document.getElementById("chatsList");
const newChatBtn = document.getElementById("newChat");
const voiceSelect = document.getElementById("voiceSelect");

let activeMessages = [];
let localChats = [{ id:0, title:"Welcome", messages:[{role:"assistant",text:"Hey, I'm URA! Let's chat."}]}];
let activeChatId = 0;

function scrollChat(){ chatEl.scrollTop = chatEl.scrollHeight; }
function formatHtml(t){ return t.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/\n/g,"<br>"); }
function renderMessages(msgs){
  chatEl.innerHTML = "";
  msgs.forEach(m=>{
    const div = document.createElement("div");
    div.className = "msg " + (m.role==="user"?"user":"bot");
    div.innerHTML = formatHtml(m.text);
    chatEl.appendChild(div);
  });
  scrollChat();
}

async function askGroq(prompt){
  const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":`Bearer ${GROQ_API_KEY}`
    },
    body:JSON.stringify({
      model:MODEL,
      messages:[
        {role:"system",content:"You are URA, a helpful AI assistant."},
        ...activeMessages.map(m=>({role:m.role==="user"?"user":"assistant",content:m.text})),
        {role:"user",content:prompt}
      ]
    })
  });
  const data = await res.json();
  return data.choices?.[0]?.message?.content || "Error from Groq.";
}

async function sendFlow(text){
  activeMessages.push({role:"user",text});
  renderMessages(activeMessages);
  activeMessages.push({role:"assistant",text:"â€¦thinkingâ€¦"});
  renderMessages(activeMessages);
  try{
    const reply = await askGroq(text);
    activeMessages[activeMessages.length-1].text = reply;
  }catch{ activeMessages[activeMessages.length-1].text="Network error."; }
  renderMessages(activeMessages);
}

sendBtn.onclick = ()=>{
  const t = inputEl.value.trim();
  if(!t) return;
  inputEl.value="";
  sendFlow(t);
};

inputEl.addEventListener("keydown",e=>{
  if(e.key==="Enter" && !e.shiftKey){
    e.preventDefault();sendBtn.click();
  }
});

let recognition;
micBtn.onclick = ()=>{
  if(!("webkitSpeechRecognition" in window)){ alert("Speech recognition not supported"); return; }
  if(!recognition){
    recognition = new webkitSpeechRecognition();
    recognition.lang="en-GB";
    recognition.onresult=e=>{
      const t = e.results[0][0].transcript;
      sendFlow(t);
    };
  }
  recognition.start();
};

renderMessages(localChats[0].messages);
</script>
</body>
</html>
